.. _sampling:

========
Sampling
========

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. _compass-faq-sampling:

Sampling in |compass| is the selection a subset of data
from a particular collection and analyzing the documents within the
sample set.

Sampling is a common technique in statistical analysis because analyzing
a subset of the data gives similar results to analyzing all of it. In
addition, sampling allows results to be generated quickly rather than
performing a computationally-expensive collection scan.

Sampling Strategy
-----------------

Sampling is chosen for its efficiency: the amount of time required to
perform a sample is minimal, on the order of a few seconds. Increasing
the sample confidence will demand more processing power and time.
Furthermore, sophisticated outlier detection requires an inspection of
every document in a MongoDB deployment, which would be unfeasible for
large data sets. The MongoDB team is in the process of conducting user
tests on large data sets to find a reasonable balance.

Sampling Methods
----------------

|compass| employs two distinct sampling mechanisms.

In MongoDB 3.2, collections are sampled with the
:manual:`$sample </reference/operator/aggregation/sample/>` operator via
the :manual:`aggregation pipeline </core/aggregation-pipeline>`. This
provides efficient random sampling without replacement over the entire
collection, or over the subset of documents specified by a query.

.. _compass_fallback_sampling:

In MongoDB 3.0, collections are sampled via a
backwards-compatible algorithm executed entirely within |compass|. It
takes place in three stages:

1. |compass| opens a :term:`cursor` on the desired collection, limited
   to at most 10,000 documents sorted in descending order of the ``_id``
   field.
2. ``sampleSize`` documents are randomly selected from the stream. To
   do this efficiently, |compass| employs `reservoir sampling
   <http://en.wikipedia.org/wiki/Reservoir_sampling>`_.
3. |compass| performs a query to select the chosen documents directly
   via ``_id``.

``sampleSize`` is set to 1000 documents.

.. note::
  The choice of sampling method is done transparently in the
  background, with no changes required by the user.
