=====
Usage
=====

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Understanding the types of fields
---------------------------------

Compass displays the data types that populate each field. In
the example below, there is a field called ``arrivalGateDelayMinutes``
which contains numbers. The percentage of documents in which the
field also appears.

.. figure:: /images/compass/arrival-gate-delay.png
  :figwidth: 249px

By hovering the cursor over the bar, you can see that 50% of the
documents in this collection store a number in this field, and 50% of
documents don't contain the field.

.. figure:: /images/compass/arrival-gate-mouseover.png
  :figwidth: 246px

Understanding the charts
------------------------

There are different charts for each data type in Compass.

Strings
~~~~~~~

Strings can appear in three different ways. If there are
entirely unique strings in a field, Compass shows a random
selection of string values from the specified field. Click
the circular refresh icon to see
a new set of randomly selected values from the field.

.. figure:: /images/compass/string-sample.png
  :figwidth: 609px

If there are only a few different string values,
Compass shows the strings in a single graded bar which
shows the percentage of the population of the string values.

.. figure:: /images/compass/string-sample2.png
  :figwidth: 620px

If there are multiple string values with some duplicates,
Compass shows a histogram indicating the frequency of
each string found within the field.

.. figure:: /images/compass/string-sample3.png
  :figwidth: 615px

Note: mousing over each bar displays a tool tip showing
the value of the string.

Numbers
~~~~~~~

Numbers are similar to strings in their representation.
Entirely unique numbers are shown in the following manner:

.. figure:: /images/compass/number-sample.png
  :figwidth: 521px

Duplicate numbers are shown in a histogram that indicates their
frequency:

.. figure:: /images/compass/number-sample2.png
  :figwidth: 529px

Sub-documents and Arrays
~~~~~~~~~~~~~~~~~~~~~~~~

Fields that contain a sub-document or an array are displayed with
a small triangle next to them and a visual representation of the
data contained within the sub-document or array.

.. figure:: /images/compass/subdocument-sample.png
  :figwidth: 572px

Click on the triangle to expand the field and view the sub-documents
within:

.. figure:: /images/compass/subdocument-sample2.png
  :figwidth: 639px

Dates and ObjectIDs
~~~~~~~~~~~~~~~~~~~

Fields that represent dates (and fields that contain the ObjectID
data type, which includes a timestamp) are shown across multiple
bar charts. The two charts on the top row represent the day of the
week and time of day of the timestamp value.

The single chart on the bottom shows the first and last timestamp
value, and the vertical lines represent the distribution of the
timestamp across the range of first to last.

.. figure:: /images/compass/date-sample.png
  :figwidth: 615px

Viewing charts of mixed types
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If a field has mixed types, you can view different
charts of each type by clicking on the ``type`` field.
In the example below, the ``age`` field shows its values
as a string:

.. figure:: /images/compass/mixed-sample.png
  :figwidth: 602px

Clicking on the ``number`` type causes the chart to show
the data as a number:

.. figure:: /images/compass/mixed-sample2.png
  :figwidth: 278px

Building a query
----------------

There are two methods for building queries in Compass. You
can either type the query out manually, or you can
automatically generate queries with the Compass query
builder.

Using the clickable query builder
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Click the chart values that you wish to include in a query

Each range of bars in the charts is clickable. Click on the
chart value and it builds a query with the
correct MongoDB syntax in the query bar. The example below shows
how to create a query for all documents where **EWR** is the departure
airport by clicking the **EWR** value in the chart for the
``departureAirportFsCode`` field.

.. figure:: /images/compass/query-builder.png
  :figwidth: 740px

Clicking on other field values creates a more complex query. The
following example shows how to extend the previous query to include
a flight ID.

.. figure:: /images/compass/query-builder2.png
  :figwidth: 740px


It is also possible to select multiple values within the same field
by either clicking and dragging the cursor over a selection of values,
or by shift+clicking on the desired values.

.. figure:: /images/compass/query-builder3.png
  :figwidth: 740px

You can also deselect a previously selected value by
shift+clicking on the highlighted value:

.. figure:: /images/compass/query-builder4.png
  :figwidth: 740px

2. Click the Apply button and view the updated results

To run the query, click the Apply button. You can clear your query by
pressing the reset button.

The other method of building queries is to manually type the query in
the query bar. It is also possible to compose the initial query by
using the clickable query builder and then manually editing the
generated query to refine it to your exact requirements. Composing
``$OR`` queries is not yet possible with the clickable query builder,
but you can be manually enter them in the query bar.

Typing the query in the query bar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Type the query you wish to run in the query bar

You can type MongoDB queries into the query bar of
Compass. These queries are executed as find only, and must be
valid MongoDB syntax. 

.. figure:: /images/compass/query-bar.png
  :figwidth: 740px

The query bar will remain red until a valid query is entered, at which
point it will turn green and the query can proceed. The Compass screen
updates to indicate which field/value has been
selected in the query.

The results of the query are from a sampled set of documents, unless
the query is granular enough to provide results under the sample
threshold. In that case, the data from the entire result set is used.

Known issues:

- It is not possible to append a sort or a limit onto the end of your
  query.
- Aggregation framework queries are not yet supported.
- ``$text`` and ``$elemMatch`` are not yet supported.
- Non-standard BSON types such as ``Timestamp`` and ``MinKey`` must be
  entered using strict
  :manual:`extended JSON </reference/mongodb-extended-json/>` syntax.

.. code-block:: javascript

  { foo : { $timestamp : { $t : 1234, $i : 12 } } }

2. Click the Apply button and view the updated results

.. figure:: /images/compass/query-builder5.png
  :figwidth: 740px

As the above image shows, Compass updates its results to match the
query that was run. In this case, the query found documents where the
airport departure code was ``LGA``.

Click the Reset button to clear the results of the query.

Viewing indexes
---------------

Switch to the Indexes tab to view the indexes of a collection.

.. figure:: /images/compass/index-view.png
  :figwidth: 740px

**Name and definition** of an index: The name of the index and
whether the index is ascending or descending.

**Type of index:** Regular, text, geospatial or hashed index.

**Size of index:** How large the index is.

**Usage of index:** Number of times the index has been used
since the time the index was created or the last server restart.

**Properties of index:** Whether there are any special properties
of the index.

Viewing query execution (explain) plans
---------------------------------------

Switch to the Explain Plan tab to view the execution plan of a query.

.. figure:: /images/compass/query-plan.png
  :figwidth: 740px

Key information about the execution plan:

.. figure:: /images/compass/query-plan2.png
  :figwidth: 740px

Check details in the raw output, also provided:

.. figure:: /images/compass/query-plan3.png
  :figwidth: 740px

For more information about execution plans, please see the
:manual:`MongoDB documentation</tutorial/analyze-query-plan/>`.

New in Compass Beta 1.3: visualize explain stages
in a tree format. Each stage of the pipeline appears as a node
on the tree. This makes sharded cluster outputs 
easier to understand and visualize.

.. figure:: /images/compass/query-plan4.png
  :figwidth: 740px

Viewing documents
-----------------

Use the Documents tab to view individual documents. When the Documents
tab loads, Compass displays all documents that match your query criteria
(or all documents within the sample if no query criteria was
specified).

.. figure:: /images/compass/doc-view.png
  :figwidth: 740px

Beta 1.3: Inserting, modifying and deleting documents
-----------------------------------------------------

New in Compass beta 1.3: you an edit, insert, and delete
documents in the Documents tab.

Inserting documents
~~~~~~~~~~~~~~~~~~~

Click the Insert button to insert a new document:

.. figure:: /images/compass/insert-button.png
  :figwidth: 495px

The following insert dialogue appears:

.. figure:: /images/compass/insert-document.png
  :figwidth: 740px

To insert new fields, provide key-value pairs by tabbing
through the fields.

.. figure:: /images/compass/insert-document2.png
  :figwidth: 740px

You can change the data type of a field by using the data type
selectors on the right of the field. The following example shows
an array with three strings:

.. figure:: /images/compass/insert-document3.png
  :figwidth: 740px

To change the ``_id`` field to use a custom value, change
the data type from ``ObjectID`` to ``string`` and then overwrite the
``_id`` value:

.. figure:: /images/compass/insert-document4.png
  :figwidth: 740px

Cloning documents
~~~~~~~~~~~~~~~~~

It is also possible to insert new documents by cloning
the schema and values of an existing document in a collection.

To clone a document, hover over the desired document
and click the ``Clone`` button.

.. figure:: /images/compass/clone-doc.png
  :figwidth: 740px

This creates a new insert dialog with the same schema
and values. You can edit any of these fields and values before
you insert the new document.

.. figure:: /images/compass/clone-doc2.png
  :figwidth: 740px

Modifying documents
~~~~~~~~~~~~~~~~~~~

You can edit documents can with a powerful
editing visualizer. To edit a document, hover over it and
select the pencil icon:

.. figure:: /images/compass/edit-doc.png
  :figwidth: 740px


After you click the pencil icon, the document enters edit mode:

.. figure:: /images/compass/edit-doc2.png
  :figwidth: 740px

You can now make changes to the fields, values, or data types
of values. You can delete fields by selecting the ``x`` icon to the
left of the field:

.. figure:: /images/compass/edit-doc3.png
  :figwidth: 740px

Once selected, the field is marked for removal and appears
highlighted in red:

.. figure:: /images/compass/edit-doc4.png
  :figwidth: 740px

To insert a new field, click or tab to the end of the document and
fill in the field/value. New fields appear highlighted in green:

.. figure:: /images/compass/edit-doc5.png
  :figwidth: 740px

Modifying documents
~~~~~~~~~~~~~~~~~~~

You can modify documents by clicking on existing field names or
values and making changes. In this example, the flight status was
changed from ``L`` to ``M``. Changed fields appear highlighted in
yellow:

.. figure:: /images/compass/edit-doc6.png
  :figwidth: 740px

When you are finished editing the document, click the ``Update``
button to commit your changes.

Deleting documents
~~~~~~~~~~~~~~~~~~

You can delete documents by hovering over the document and
selecting the trash icon:

.. figure:: /images/compass/delete-doc.png
  :figwidth: 740px

The document is marked for deletion and Compass
asks for confirmation that you want to remove the document:

.. figure:: /images/compass/delete-doc2.png
  :figwidth: 740px

After you confirm, Compass deletes the document
from the collection.
