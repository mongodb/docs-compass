.. _compass-run-atlas-search-query:

========================
Run Atlas Search Queries
========================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Atlas Search queries take the form of an :ref:`aggregation pipeline stage 
<compass-agg-builder>`. If you have an existing Atlas Search Index for data on 
your Atlas cluster, you can run :pipeline:`$search` and :pipeline:`$searchMeta` 
queries. If you have an  existing Atlas Vector search index on your data in 
Atlas, you can also run :pipeline:`$vectorSearch` queries. 

Before You Begin 
----------------

Create an :ref:`Atlas Search index <compass-create-search-index>` or an 
:ref:`Atlas Vector Search index <compass-create-vector-search>`.

.. note:: 
   
   You can manage Atlas Search indexes in the |compass-short| UI if your 
   deployment is local, has an Atlas cluster tier of M10 or larger, and runs 
   MongoDB 7.0 or later. 

Steps
-----

.. procedure:: 
   :style: normal
   
   .. step:: Find the index you want to use in your query

      From the :guilabel:`Indexes` tab, click :guilabel:`Search Indexes`. 
      Hover over the search index you want to use in your query. Click the 
      :guilabel:`Aggregate` button that appears to open the aggregation 
      pipeline builder.
         
   .. step:: Construct your query
      
      If you have an Atlas Search index, add the ``$search`` or 
      ``$searchMeta`` stage to your aggregation pipeline. If you have an 
      Atlas Vector Search index, add the ``$vectorSearch`` stage.

      .. note:: 

         The Atlas Search ``$search`` and ``$searchMeta`` and 
         the Atlas Vector Search ``$vectorSearch`` pipeline stages must 
         be the first stage in your aggregation pipeline.

   .. step:: Run your query

Learn More 
----------

- :atlas:`Atlas Search Pipeline Stages </atlas-search/query-syntax/>`

- :atlas:`Atlas Vector Search Pipeline Stage </atlas-vector-search/vector-search-stage/>`
